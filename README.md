# Agencies
# Infrastructure Setup Terraform Configuration

This Terraform configuration sets up the infrastructure required for a data lake environment, including VPC, subnets, S3 bucket, IAM role, and AWS Transfer for SFTP server. The code is organized into modules for easy maintenance and scalability.

## Prerequisites

Before using this Terraform configuration, ensure you have the following:

- AWS credentials with appropriate permissions to create and manage the required resources.
- Terraform CLI installed on your local machine.

## Usage

1. Clone the repository to your local machine:

   ```
   git clone https://github.com/your-github-repo.git
   ```

2. Change to the repository directory:

   ```
   cd your-github-repo
   ```

3. Update the `main.tf` file with your desired configuration, such as the desired region and VPC settings.

4. Optionally, update the `variables.tf` file to customize the values of input variables used in the Terraform configuration.

5. Initialize the Terraform working directory:

   ```
   terraform init
   ```

6. Review the planned changes:

   ```
   terraform plan
   ```

7. Apply the Terraform configuration:

   ```
   terraform apply
   ```

   You will be prompted to confirm the changes. Enter `yes` to proceed.

8. Once the Terraform apply completes successfully, the infrastructure will be provisioned as per the specified configuration.
## Modules

The Terraform code is organized into the following modules:

- `vpc`: Creates a VPC with the specified CIDR block.
- `subnets`: Creates a public subnet and a private subnet within the VPC.
- `s3_bucket`: Creates an S3 bucket for data lake storage with server-side encryption using AWS Key Management Service (KMS).
- `iam_role`: Creates an IAM role for SFTP access to the S3 bucket.
- `transfer_server`: Creates an AWS Transfer for SFTP server with the specified endpoint and identity provider.
- `security_group`: Creates a security group for the SFTP server with the necessary ingress and egress rules.

Feel free to explore each module's configuration files for further customization.
## CloudWatch Monitoring and Alerting

This Terraform code includes configuration for CloudWatch monitoring and alerting. CloudWatch is a monitoring and management service provided by AWS that allows you to collect and track metrics, collect and monitor log files, and set alarms.

### Missing Data Alert

A CloudWatch metric alarm named "MissingDataAlarm" is set up in this infrastructure deployment. This alarm is designed to detect any missing data from agencies and trigger alerts accordingly.

When the alarm threshold is breached, it indicates that there is missing data from the agencies. The alarm triggers the specified actions, in this case, sending a notification to the SRE team via the configured SNS topic "ErrorInFiles".

To customize the alarm configuration, including the name, threshold, alarm actions, and dimensions, you can modify the `cloudwatch.tf` file in the CloudWatch metric alarm resource block.

### Monitoring and Troubleshooting

CloudWatch provides a comprehensive set of monitoring and troubleshooting features. You can leverage the CloudWatch console or APIs to:

- View and analyze metrics collected from various AWS resources.
- Set up additional alarms and notifications for different metrics and thresholds.
- Create custom dashboards to visualize and monitor the health and performance of your infrastructure.
- Collect and monitor log files generated by AWS services or your applications.
- Analyze logs using CloudWatch Logs Insights to identify issues or troubleshoot problems.

For more information on CloudWatch features and capabilities, refer to the [AWS CloudWatch Documentation](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html).


## Cleanup
To destroy the infrastructure and remove all created resources, run the following command:

   ```
   terraform destroy
   ```

   You will be prompted to confirm the destruction of resources. Enter `yes` to proceed.
## Version Control and Collaboration

The Terraform code and related documentation are stored in a public GitHub repository at [https://github.com/your-github-repo](https://github.com/your-github-repo). You can collaborate with team members by cloning the repository, making changes, and submitting pull requests to propose modifications.

## License

This Terraform configuration is provided under the [MIT License](LICENSE). Feel free to modify and adapt it to suit your needs.

## Contributing

Contributions to this Terraform configuration are welcome! If you find any issues or have suggestions for improvements, please submit an issue or pull request on the GitHub repository.
